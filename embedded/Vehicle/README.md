# 机器人车辆控制系统

## 系统概述

本仓库包含基于STM32F4微控制器构建的机器人车辆控制系统的嵌入式软件。该系统集成了底盘运动控制、机械臂操作、视觉反馈处理和自动化任务执行功能。

## 架构

软件结构分为几个关键模块：

### 1. 核心控制系统
- 电机驱动与反馈
- PID控制器实现
- 全向移动的底盘运动学
- 状态管理和模式切换

### 2. 通信接口
- 用于电机通信的CAN总线
- 用于视觉反馈和传感器数据的UART
- 命令协议处理

### 3. 任务管理
- 基于FreeRTOS的多任务处理
- 运动控制、机械臂控制和传感器数据的并行处理
- 定时任务调度

### 4. 机械控制组件
- 通过四个麦克纳姆轮的底盘运动控制
- 具有多自由度的机械臂控制
- 夹持机构控制

## 关键组件

### 电机控制 (CAN_receive.c/h)
电机控制模块通过CAN总线处理与DJI电机的通信。它提供：
- 电机数据接收和解码
- 电流控制命令生成
- 角度和速度跟踪
- 信号处理的卡尔曼滤波

### 机器人任务控制 (mytask.c/h)
此模块实现核心机器人功能：
- 位置和速度控制模式
- 麦克纳姆轮运动学计算
- 运动命令处理
- 传感器反馈集成

### 机械臂控制 (arm_task.c/h)
管理机械臂操作：
- 物料抓取和放置顺序
- 使用视觉反馈的位置校正
- 基于颜色的分拣操作
- 预定义的处理任务运动序列

### 主应用程序 (main.c)
作为入口点，处理：
- 系统初始化
- 与传感器的UART通信
- 视觉系统命令解析
- 数据转发到适当的子系统

## 通信协议

### 视觉系统接口
机器人通过UART接收定位和命令数据：
- 位置和速度模式的移动命令
- 用于位置校正的视觉反馈
- 用于物料处理的颜色序列检测

### 电机接口
电机通过CAN总线控制：
- 带PID的位置控制
- 可配置加速度的速度控制
- 电流反馈监控

## 操作模式

### 底盘控制
- **位置模式**：带PID的闭环位置控制
- **速度模式**：麦克纳姆轮的直接速度控制
- **视觉校正**：基于相机反馈的位置调整

### 机械臂控制
- 从转盘取料
- 中间存储操作
- 基于颜色序列的最终堆叠

## 自动化序列

机器人实现了几种用于物料处理的自动化序列：
1. 从旋转平台收集物料
2. 加工区操作
3. 按颜色分类
4. 按特定模式进行最终堆叠

## 硬件依赖
- STM32F4微控制器
- DJI智能电机（2006/6020）
- 用于方向感应的IMU
- 用于视觉反馈的相机系统
- 麦克纳姆轮驱动系统
- 多自由度机械臂

## 许可证信息
- CMSIS组件采用Apache-2.0许可
- STM32F4xx HAL驱动采用BSD-3-Clause许可